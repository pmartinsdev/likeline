import { SuperTest, Test } from "supertest"
import { getApiForTest } from "../../../../utils/get-api-for-test"
import { CreateUserDTO } from "@api/endpoints/user/dtos/create-user"
import { GLOBAL_PREFIX } from "@api/server"

let api: SuperTest<Test>
const BASE_URL = `${GLOBAL_PREFIX}/users`

describe("CONTROLLER -  CreateUser", () => {
  beforeAll(async () => {
    api = await getApiForTest()
  })

  describe("sucessful cases", () => {
    const USER_PAYLOAD: CreateUserDTO = {
      name: 'john Doe',
      username: '_doe',
      email: 'doe@email.com',
      password: '123',
      confirmPassword: '123'

    }

    it("Must create a new user if it does not exists", async () => {
      const { confirmPassword: _, password: __, ...expectedResponse } = USER_PAYLOAD

      const { body, status, } = await api.post(BASE_URL).send(USER_PAYLOAD)

      console.log({body})

      expect(status).toEqual(204)
      expect(body).toEqual(expect.objectContaining(expectedResponse))
    })
  })
})
